<div class="row">
	<div class="scroll_inner_page">
		<div class="col-lg-12">
			<div class="showback">
				<h4>
					<i></i>Case Closure
				</h4>
				<form id="closeDocRequestResponseForm">
					<div>
						<div class="col-lg-6">
							<input type="hidden" name="userId" id="user_Id" /> 
							<input	type="hidden" name="requestId" id="request_Id" />
							<input	type="hidden" name="requestItem" id="request_Item" />
							<div class="form-group">
								<label for="ClientId">Client Id</label>
								<!-- class="col-sm-2 control-label" -->
								<!-- <div class="col-sm-10"> -->
								<input type="text" name="Client_Id" id='clientId'
									class='form-control' size='10' readonly="readonly"
									placeholder="Client Id" />
								<!-- </div> -->
							</div>
							<div class="form-group">
								<label for="customer">Client Name</label>
								<!-- <div class="col-sm-10"> -->
								<input type="text" name="clientName" id='clientNameId'
									class='form-control' size='10' readonly="readonly"
									placeholder="Client Name" />
								<!-- </div> -->
							</div>
							<div class="form-group">
								<label for="customer">Phone No</label>
								<!-- <div class="col-sm-10"> -->
								<input type="text" name="clientPhone" id='clientPhoneId'
									class='form-control' size='10' readonly="readonly"
									placeholder="Client Phone" />
								<!-- </div> -->
							</div>
							<div class="form-group">
								<label for="customer">Email Id</label>
								<!-- <div class="col-sm-10"> -->
								<input type="text" name="clientEmail" id='clientEmailId'
									class='form-control' size='10' readonly="readonly"
									placeholder="Client Email" />
								<!-- </div> -->
							</div>
							<div class="form-group">
								<label id="LabelId" for="caseId">Case Id</label>
								<!-- <div class="col-sm-10"> -->
								<input type="text" name="case_Id" id='caseId'
									class='form-control' size='10' readonly="readonly"
									placeholder="Case Id" />
								<!-- </div> -->
							</div>
							
							<div class="form-group">
								<label for="RequestedMsg">Doc Request Message</label>
								<textarea rows="6" cols="69" name="requestMsg" id="RequestMsg"
									class='form-control' style="resize: none"></textarea>
								<span id="RequestMsgSpan" style="color: red;"></span>
							</div>
							<div class="form-group">
								<label for="Request Date">Doc Requested Date</label>
								<input type="text" name="created_Date" id='created_Date'
									class='form-control' size='10' readonly="readonly"
									placeholder="Request Created Date" />
								<span id="RequestDateSpan" style="color: red;"></span>
							</div>
							<div id="fileandbox" class="form-group">
								<label>File upload</label>
								<div class="input-group image-preview">
									<input type="text" class="form-control image-preview-filename"
										disabled="disabled">
									<!-- don't give a name === doesn't send on POST/GET -->
									<span class="input-group-btn"> <!-- image-preview-clear button -->
										<button type="button"
											class="btn btn-default image-preview-clear"
											style="display: none;">
											<span class="glyphicon glyphicon-remove"></span> Clear
										</button> <!-- image-preview-input -->
										<div class="btn btn-default image-preview-input">
											<span class="glyphicon glyphicon-folder-open"></span> <span
												class="image-preview-input-title">Browse</span> <input
												id="fileToUpload" type="file" accept=".jpg,.jpeg,.png,.docx,.doc,.xls,.xlsx,.pdf,.ppt,.pptx,.zip,.ZIP,.rtf"
												name="input-file-preview" />
											<!-- rename it -->

										</div>
									</span>
								</div>
								<!-- /input-group image-preview [TO HERE]-->
								<span id="browseSpan" style="color: red;"></span>
							</div>
						</div>
						<div class="col-lg-6">
							<div class="form-group" id="caseCategoryDiv">
								<label for="Case Category" id="catLabelId">Case Category</label>
								<!-- <div class="col-sm-10"> -->
								<input type="text" name="caseCategory" id='caseCategoryId'
									class='form-control' size='10' readonly="readonly"
									placeholder="Category" />
								<!-- </div> -->
							</div>
							<div class="form-group" id="caseSubCategoryDiv">
								<label for="Case SubCategory" id="subCatLabelId">Case SubCategory</label>
								<!-- <div class="col-sm-10"> -->
								<input type="text" name="caseSubCategory" id='caseSubCategoryId'
									class='form-control' size='10' readonly="readonly"
									placeholder="SubCategory" />
								<!-- </div> -->
							</div>
							<div class="form-group">
								<label for="CreatedDate">Created On</label>
								<!-- <div class="col-sm-10"> -->
								<input type="text" name="createdDate" id='createdDateId'
									class='form-control' size='10' readonly="readonly"
									placeholder="Created Date" />
								<!-- </div> -->
							</div>
							<div class="form-group">
								<label for="AssignDate">Assign On</label>
								<!-- <div class="col-sm-10"> -->
								<input type="text" name="assignDate" id='assignDateId'
									class='form-control' size='10' readonly="readonly"
									placeholder="Assign Date" />
								<!-- </div> -->
							</div>
							<div class="form-group">
								<div class="col-lg-6 navbar-dashbord">
									<div class="page-title">
										<h2>Document Upload Status</h2>
									</div>
								</div>

								<div class="">
									<table id="filetable" class="table table-striped custab">
										<thead>

											<tr>
												<th>File Name</th>
												<th>File Size</th>
												<th>Action</th>
												<th>Upload Status</th>
											</tr>
										</thead>



									</table>

								</div>
							</div>
							<div class="form-group">
								<label for="ResponseMsg">Doc Response Message</label>
								<textarea rows="6" cols="69" name="responseMsg" id="ResponseMsg"
									class='form-control' style="resize: none"></textarea>
								<span id="responseMsgSpan" style="color: red;"></span>
							</div>
						
						<div class="form-group">
							<div class="col-sm-12" align="right" style="margin-bottom: 10px;">
								<button class="btn btn-blue" type="button"
									style="background: #323f3f; color: #fff;" id="ClientDashboard">Cancel</button>
								<button class="btn btn-blue" type="button"
									style="background: #323f3f; color: #fff;"
									id="submitRequestFromAdminButton"
									onclick="validateDocResponseClient();">Submit</button>
							</div>
						</div>
						</div>
						

					</div>


					<!-- <input type="hidden" id="autoSgstclienNameId" /> <input
						type="hidden" name="addressLine1" id="addressLine1" /> <input
						type="hidden" name="addressLine2" id="addressLine2" /> <input
						type="hidden" name="pinCode" id="pincode" /> <input type="hidden"
						name="country" id="country" /> <input type="hidden" name="state"
						id="state" /> <input type="hidden" name="type" id="pageId" /> <input
						type="hidden" name="lawyerId" id="lawer" /> <br> <input
						type="hidden" name="clientId" id="clientId" /> -->
				</form>
			</div>


		</div>
	</div>
</div>






<script>

	var fileArray = [];
	var totalFileSize = 0;
	$("input:file")
			.change(
					function(objEvent) {
						
						
						var objFormData = new FormData();
						// GET FILE OBJECT 
						var objFile = $(this)[0].files[0];
						totalFileSize = totalFileSize + objFile.size;
						if (totalFileSize > 5000000) {
							totalFileSize = totalFileSize - objFile.size;
							$("#browseSpan").text("File Size Exceeded");
							$("#fileToUpload").val("");
						} else {
							item = {}
							var fname = String(objFile.name.replace(
									/[^A-Z0-9]+/ig, ""));
							item["filenames"] = fname.replace(/\s\s+/g, ' ');
							item["filesizes"] = String(objFile.size);
							item["filestatus"] = "Uploaded";
							fileArray.push(item);
							$('#filetable').dataTable().fnDestroy();
							$("#filetable")
									.dataTable(
											{
												"bProcessing" : true,
												"sort" : "position",
												"bStateSave" : false,
												"iDisplayLength" : 5,
												"iDisplayStart" : 0,
												"aaData" : fileArray,
												"aoColumns" : [
														{
															"mData" : "filenames"
														},
														{
															"mData" : "filesizes"
														},
														{
															"mData" : null,
															render : function(
																	data, type,
																	full, meta) {
																return '<input type="button" name="removeButton" id="'+ data.filenames +'" value="Remove">';
															}
														},
														{
															"mData" : null,
															render : function(
																	data, type,
																	full, meta) {

																return '<div id="count'+ data.filenames +'">'
																		+ data.filestatus
																		+ '</div>';
															}
														} ]
											});

							// APPEND FILE TO POST DATA
							//alert(case_Id);
							//alert($("#clientId").val());
							objFormData.append('file', objFile);
							objFormData.append('clientId', $("#clientId").val());
							objFormData.append('caseId', $("#request_Item").val());
							objFormData.append('requestId', $("#request_Id").val());
							$.ajax({
								url : '/LegalBell/uploadRequestedCaseFile',
								type : 'POST',
								contentType : false,
								data : objFormData,
								//JQUERY CONVERT THE FILES ARRAYS INTO STRINGS.SO processData:false
								processData : false,
								success : function(data) {
								}
							});
							$("#browseSpan")
									.text(
											"*Click on Choose File again to upload more files..");
						}
					});

	$(document).on(
			'click',
			'#filetable tbody tr td input',
			function() {
				var btnID = $(this).attr('id');
				var filname = String(btnID);
				var lastThree = filname.substr(filname.length - 3);
				if (lastThree == "pdf" || lastThree == "doc") {
					filname = filname.substring(0, filname.length - 3);
					filname = filname + "." + lastThree;
				} else {
					var lastFour = filname.substr(filname.length - 4);
					filname = filname.substring(0, filname.length - 4);
					filname = filname + "." + lastFour;
				}
				var objFormData1 = new FormData();
				objFormData1.append('filename', filname);
				objFormData1.append('clientId', $("#clientId").val());
				objFormData1.append('caseId', $("#request_Item").val());
				objFormData1.append('requestId',$("#request_Id").val());
				$.ajax({
					url : '/LegalBell/deleteRequestedCaseFile',
					type : 'POST',
					contentType : false,
					data : objFormData1,
					//JQUERY CONVERT THE FILES ARRAYS INTO STRINGS.SO processData:false
					processData : false,
					success : function(data) {
					}
				});
				$(this).closest('tr').remove();
				var a = parseInt(btnID) - 1;
				fileArray.splice(a, 1);
				totalFileSize = totalFileSize - fileInfo[1];
				$("#browseSpan").text(
						"*Click on Choose File again to upload more files..");
			});
</script>



<script type="text/javascript">
	function validateDocResponseClient() {
		if (document.getElementById("fileToUpload").value == "") {
			document.getElementById("browseSpan").textContent = "*Please Upload Requested Document.";
		}else if (document.getElementById("ResponseMsg").value == "") {
			document.getElementById("responseMsgSpan").textContent = "*Please Enter Document Request Closure Message.";
		} else {
			ajaxPost('closeDocRequestResponseForm', '/docRequestClosedByClient');
		}
	}
</script>